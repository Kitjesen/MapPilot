grpc_gateway:
  ros__parameters:
    # gRPC 服务器端口
    grpc_port: 50051
    
    # 机器人标识（可配置）
    robot_id: "robot_001"
    firmware_version: "1.0.0"
    
    # 状态流频率
    fast_state_hz: 30.0
    slow_state_hz: 1.0
    
    # 频率统计窗口（秒）
    rate_window_sec: 2.0
    
    # ==================== 核心话题 ====================
    # StatusAggregator 订阅的话题
    odom_topic: "/Odometry"
    terrain_map_topic: "/terrain_map"
    path_topic: "/path"
    slow_down_topic: "/slow_down"
    
    # 新增：丰富遥测的话题
    cmd_vel_monitor_topic: "/cmd_vel"
    planner_status_topic: "/pct_planner/status"
    way_point_topic: "/way_point"
    global_path_topic: "/pct_path"
    lidar_topic: "/cloud_registered"

    # ==================== SafetyGate 话题 ====================
    safety_odom_topic: "/Odometry"
    cmd_vel_topic: "/cmd_vel"
    stop_topic: "/stop"

    # ==================== ModeManager 话题 ====================
    mode_stop_topic: "/stop"
    mode_speed_topic: "/speed"
    goal_pose_topic: "/goal_pose"

    # ==================== DataService 话题 ====================
    data_camera_topic: "/camera/color/image_raw/compressed"
    data_camera_fallback_topic: "/camera/color/compressed"
    data_map_topic: "/overall_map"
    data_pointcloud_topic: "/cloud_registered"
    data_terrain_topic: "/terrain_map_ext"
    data_path_topic: "/path"
    data_file_root: ""
    
    # 允许客户端访问的日志目录列表（用于从机器人拉取日志）
    # DownloadFile 和 ListRemoteFiles 可读取这些目录中的文件
    log_directories: ["/var/log/robot", "/var/log/syslog", "/tmp/apply_firmware.log"]
    
    # 固件刷写脚本路径
    apply_firmware_script: "/usr/local/bin/apply_firmware.sh"
    
    # ==================== OTA 更新配置 ====================
    # 本地已安装制品 manifest 文件
    ota_manifest_path: "/opt/robot/ota/installed_manifest.json"
    # 旧版本备份目录（用于回滚）
    ota_backup_dir: "/opt/robot/ota/backup"
    # 硬件标识（用于兼容性检查）
    hw_id: "dog_v2"
    # Ed25519 公钥路径 (设备端验签)
    ota_public_key_path: "/opt/robot/ota/ota_public.pem"
    # 升级历史日志 (JSONL append-only)
    ota_history_path: "/opt/robot/ota/upgrade_history.jsonl"
    # 系统版本 JSON
    system_version_path: "/opt/robot/ota/system_version.json"

    # ==================== gRPC TLS 配置 ====================
    # 留空 = 不启用 TLS (明文); 配置后启用 TLS
    # 证书方案: 每台机器人自签证书, App 端 trust-on-first-use (类似 SSH)
    tls_cert_path: ""   # PEM 格式服务端证书, 如 "/opt/robot/certs/server.crt"
    tls_key_path: ""    # PEM 格式服务端私钥, 如 "/opt/robot/certs/server.key"

    # ==================== WebRTC 配置 ====================
    webrtc_enabled: true
    webrtc_offer_timeout_ms: 3000
    webrtc_start_command: ""
    webrtc_stop_command: ""
    webrtc_offer_path: "/tmp/webrtc_offer_{session_id}.sdp"
    webrtc_ice_path: "/tmp/webrtc_ice_{session_id}.txt"
    
    # ==================== TF 坐标系 ====================
    tf_map_frame: "map"
    tf_odom_frame: "odom"
    tf_body_frame: "body"
    
    # ==================== Safety Gate 配置 ====================
    deadman_timeout_ms: 300.0
    max_speed: 1.0
    max_angular: 1.0
    tilt_limit_deg: 30.0

    # --- SafetyGate 近场避障 ---
    obstacle_height_thre: 0.2    # 障碍物高度阈值 (m), 与 local_planner 一致
    stop_distance: 0.8           # 急停距离 (m): 前方此范围内有障碍 → 线速度归零
    slow_distance: 2.0           # 减速距离 (m): 前方此范围内有障碍 → 线性减速
    vehicle_width: 0.6           # 车身宽度 (m)
    vehicle_width_margin: 0.1    # 宽度安全裕度 (m), 实际检测半宽 = width/2 + margin

    # ==================== Han Dog Bridge 配置 ====================
    # 四足机器人 CMS gRPC 连接参数
    # dog_host: "127.0.0.1"      # 本机 (dog 控制器运行在同一设备)
    # dog_host: "192.168.4.100"  # 远程 (通过网络连接)
    # dog_port: 13145            # CMS gRPC 默认端口
